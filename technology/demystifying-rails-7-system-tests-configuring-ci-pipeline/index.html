<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Demystifying Rails 7 System Tests: Configuring CI Pipeline &#8211; eLitmus Blog</title>
<meta name="description" content="We learn new things everyday, and we document our learnings here...">

<meta name="keywords" content="Rails 7, System Tests, Integration Tests, CI-CD, Minitest, Capybara, Selenium, Selenium-webdriver, webdriver, webdrivers gem, chromedriver, arm64, amd64, linux, docker, gitlab-runner">

<!-- Twitter Cards -->
  <meta name="twitter:card" content="summary">    
<meta name="twitter:title" content="Demystifying Rails 7 System Tests: Configuring CI Pipeline">
<meta name="twitter:description" content="<p>In Rails 5.1 and later versions, system tests were introduced as a new type of test to simulate a user interacting with a web application. These tests use a headless browser, typically powered by Capybara and a WebDriver, to mimic a user’s actions like clicking buttons, filling forms, and navigating through the application.</p>

">
<meta name="twitter:site" content="@elitmus">

    

    

    

    

    

    

    

    

    

    

    

    
        
            <meta name="twitter:creator" content="@ManishS77291587">
        
    

    

    

    

    




<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:image" content="/blog/images/blog_logo_taglinedorange.png"/>
<meta property="og:type" content="article">
<meta property="og:title" content="Demystifying Rails 7 System Tests: Configuring CI Pipeline">
<meta property="og:description" content="<p>In Rails 5.1 and later versions, system tests were introduced as a new type of test to simulate a user interacting with a web application. These tests use a headless browser, typically powered by Capybara and a WebDriver, to mimic a user’s actions like clicking buttons, filling forms, and navigating through the application.</p>

">
<meta property="og:url" content="/blog/technology/demystifying-rails-7-system-tests-configuring-ci-pipeline/">

<meta property="og:site_name" content="eLitmus Blog">







<link rel="canonical" href="https://www.elitmus.com/blog/technology/demystifying-rails-7-system-tests-configuring-ci-pipeline/">
<link href="/blog/feed.xml" type="application/atom+xml" rel="alternate" title="eLitmus Blog Feed">


	<link rel="author" href="https://plus.google.com/+eLitmus?rel=author">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Icons -->
<!-- apple touch icons -->
<link rel="apple-touch-icon" sizes="57x57" href="/blog/images/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="114x114" href="/blog/images/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/blog/images/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="144x144" href="/blog/images/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="60x60" href="/blog/images/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="120x120" href="/blog/images/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="76x76" href="/blog/images/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="152x152" href="/blog/images/apple-touch-icon-152x152.png">
<!-- Favicons default 16x16 -->
<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="/blog/favicon.ico">

<!-- Favicons others -->
<link rel="icon" type="image/png" href="/blog/images/favicon-196x196.png" sizes="196x196">
<link rel="icon" type="image/png" href="/blog/images/favicon-160x160.png" sizes="160x160">
<link rel="icon" type="image/png" href="/blog/images/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/blog/images/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/blog/images/favicon-32x32.png" sizes="32x32">

<!-- Icons for Windows 8 Tiles -->
<meta name="msapplication-TileColor" content="#ffffff"/>
<meta name="msapplication-TileImage" content="/blog/images/mstile-144x144.png">

<!-- For all browsers -->


<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:600,300,300italic|The+Girl+Next+Door" rel="stylesheet" type="text/css">
<link href='//fonts.googleapis.com/css?family=Source+Code+Pro:300' rel='stylesheet' type='text/css'>

<meta http-equiv="cleartype" content="on">

<!-- bootstrap 4 -->
<link rel="stylesheet" type="text/css" href="/blog/assets/css/bootstrap.min.css">

<!-- below css file is used for navbar in individual blogposts -->
<link rel="stylesheet" type="text/css" href="/blog/assets/css/main.min.css">

<!-- <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css"> -->

<!-- Optional theme -->
<link rel="stylesheet" type="text/css" href="/blog/assets/css/bootstrap-theme.min.css">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Font Awesome -->
<link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="/blog/assets/css/font-elitmuslogo.css" />

<link rel="stylesheet" href="/blog/assets/css/customize.css">
<link rel="stylesheet" href="/blog/assets/css/forkit.css">
</head>

<body id="post">

  <header class="headroom">

  <nav class="navbar navbar-expand-md navbar-dark bg-black fixed-top" role="navigation">

      <a class="navbar-brand" href="/blog/">
        <img src="https://cdn0.elitmus.net/assets/elitmus-only-logo-6efc8a74032179afdb89829a093e05bd05d627dd4354bbd1ff7f4eb5db8a0af8.svg" class="img-logo">
        <span><div class="blog-label">blog</div></span>
      </a>

      <!-- the toggle button -->
      <button type="button" class="navbar-toggler" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="navbar-toggler-icon"></span>
        <span class="sr-only">Toggle navigation</span><!-- only for screen readers -->
      </button>

      <div class="collapse navbar-collapse">
        <ul class="nav navbar-nav mr-auto">

          <!-- first item = dropdown search -->
          <li class="nav-item">
            <div class="dropdown search-box-margin">

            
              <div class="form-inline">
                 

                <input data-toggle="dropdown" placeholder="Search..." id="search-box" class="form-control form-control-sm search-input dropdown-toggle" aria-haspopup="true" aria-expanded="false">


                <div class="dropdown-menu" id="search-dropdown">
                  <a role='presentation' class='dropdown-item search-results'> Type more.... </a>
                </div>

              </div>



            <!-- the below line will pass "search word" to search.html -->

            <!--
            <form class="form-inline" action="/blog/search" method="get">
               


              <label for="search_box">Search</label>
              <input data-toggle="dropdown" type="text" name="query" placeholder="Search..." id="search-box" class="form-control form-control-sm search-input dropdown-toggle" aria-haspopup="true" aria-expanded="false">

              <div class="dropdown-menu" id="search-dropdown">
                  <a role='presentation' class='dropdown-item search-results'> Type more.... </a>
              </div>

              <input type="submit" value="search">

            </form>
            -->

            <!-- end of form -->


            </div>
          </li>
        </ul>

        

        <!-- every link on the right side -->
        <ul class="nav navbar-nav navbar-right nav-icon-size-reduce">
          
          <li class="nav-item">
             
              <a href="/blog/" class="nav-link">
                <i class="fa fa-home"></i> Home
              </a>
            
          </li>
          
          <li class="nav-item">
             
              <a href="/blog/posts/" class="nav-link">
                <i class="fa fa-file-text-o"></i> Posts
              </a>
            
          </li>
          
          <li class="nav-item">
             
              <a href="//www.elitmus.com/" class="nav-link">
                <i class="el el-elitmuslogo"></i> eLitmus
              </a>
            
          </li>
          

          <!-- feed is the last link -->
          <li class="nav-item">
            <a href="/blog/feed.xml" class="nav-link" title="Atom/RSS feed">
              <i class="fa fa-rss"></i> Feed
            </a>
          </li>
        </ul>



      </div> <!-- /.navbar-collapse -->

  </nav><!--[if lt IE 9]><div class="upgrade"><strong><a href="https://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
</header>
<!-- 

  <div class="search-wrapper">
    <div class="search-form">
      <input type="text" class="search-field" placeholder="Search...">
      <i class="icon-remove-sign icon-2x"></i>
      <ul class="search-results post-list"></ul> -->
<!-- /.search-results -->
<!-- </div> -->
<!-- /.search-form -->
<!-- </div> -->
<!-- ./search-wrapper -->
<!--  -->

  

  <div class="container-fluid">

  <div class="row">


    <div class="col-md-2"></div>
      <div class="col-md-8">
        

        <div id="main" role="main" class="marginal">
          <article class="entry">

            

            <div>
              <header>
                <span class="entry-tags">
                  
                    <a href="/blog/tags/#Rails 7" title="Pages tagged Rails 7">Rails 7</a>
                    &nbsp;&bull;&nbsp;
                  
                    <a href="/blog/tags/#System Tests" title="Pages tagged System Tests">System Tests</a>
                    &nbsp;&bull;&nbsp;
                  
                    <a href="/blog/tags/#Integration Tests" title="Pages tagged Integration Tests">Integration Tests</a>
                    &nbsp;&bull;&nbsp;
                  
                    <a href="/blog/tags/#CI-CD" title="Pages tagged CI-CD">CI-CD</a>
                    &nbsp;&bull;&nbsp;
                  
                    <a href="/blog/tags/#Minitest" title="Pages tagged Minitest">Minitest</a>
                    &nbsp;&bull;&nbsp;
                  
                    <a href="/blog/tags/#Capybara" title="Pages tagged Capybara">Capybara</a>
                    &nbsp;&bull;&nbsp;
                  
                    <a href="/blog/tags/#Selenium" title="Pages tagged Selenium">Selenium</a>
                    &nbsp;&bull;&nbsp;
                  
                    <a href="/blog/tags/#Selenium-webdriver" title="Pages tagged Selenium-webdriver">Selenium-webdriver</a>
                    &nbsp;&bull;&nbsp;
                  
                    <a href="/blog/tags/#webdriver" title="Pages tagged webdriver">webdriver</a>
                    &nbsp;&bull;&nbsp;
                  
                    <a href="/blog/tags/#webdrivers gem" title="Pages tagged webdrivers gem">webdrivers gem</a>
                    &nbsp;&bull;&nbsp;
                  
                    <a href="/blog/tags/#chromedriver" title="Pages tagged chromedriver">chromedriver</a>
                    &nbsp;&bull;&nbsp;
                  
                    <a href="/blog/tags/#arm64" title="Pages tagged arm64">arm64</a>
                    &nbsp;&bull;&nbsp;
                  
                    <a href="/blog/tags/#amd64" title="Pages tagged amd64">amd64</a>
                    &nbsp;&bull;&nbsp;
                  
                    <a href="/blog/tags/#linux" title="Pages tagged linux">linux</a>
                    &nbsp;&bull;&nbsp;
                  
                    <a href="/blog/tags/#docker" title="Pages tagged docker">docker</a>
                    &nbsp;&bull;&nbsp;
                  
                    <a href="/blog/tags/#gitlab-runner" title="Pages tagged gitlab-runner">gitlab-runner</a>
                    
                  

                  <div class=' social-sharing pull-right'>        
     
</div>

                </span>
              
                
                  <h1 class="no-padding">Demystifying Rails 7 System Tests: Configuring CI Pipeline</h1>
                
              </header>
            </div>
           
            <div>
              <div>
                <span class='badge badge-warning'> <a href="/blog/categories/technology/index.html" > technology </a></span>
              </div>

              

              <div class="post-content-justify">
                <p>In Rails 5.1 and later versions, system tests were introduced as a new type of test to simulate a user interacting with a web application. These tests use a headless browser, typically powered by Capybara and a WebDriver, to mimic a user’s actions like clicking buttons, filling forms, and navigating through the application.</p>

<h3 id="why-do-we-need-system-tests"><strong>Why do we need System Tests?</strong></h3>

<ul>
  <li><a href="https://guides.rubyonrails.org/testing.html#system-testing" target="_blank" style="color: blue;">System tests</a> let you test applications in the browser. Because system tests use a real browser experience, you can test all of your JavaScript easily from your test suite.</li>
  <li>Typically used for:
    <ul style="margin-left: 2rem">
<li><strong>Acceptance testing:</strong> verify that the app has implemented a specific feature</li>
<li><strong>Smoke testing:</strong> verify that the app is functional on a fundamental level and doesn't have code issues.</li>
<li><strong>Characterization testing:</strong> is a type of software testing that involves examining and documenting the behavior of an existing system or application without making any modifications to its code</li>
</ul>
  </li>
</ul>
<div style="margin-top: 2rem"></div>
<h3 id="how-we-can-run-system-test"><strong>How we can run System Test?</strong></h3>

<ul>
  <li>System Test interacts with your app via an actual browser to run them.</li>
  <li>From a technical perspective, system tests aren’t necessarily required to interact with a real browser; they can be set up to utilize the <a href="https://github.com/rack/rack-test" target="_blank" style="color: blue;">rack test</a> backend, which emulates HTTP requests and processes the HTML responses. While system tests based on rack_test run faster and more dependable than front-end tests involving an actual browser, they have notable limitations in mimicking a genuine user experience as they are incapable of executing JavaScript.</li>
</ul>

<div style="margin-top: 2rem"></div>
<h3 id="the-anatomy-of-a-system-test"><strong>The Anatomy of a System Test?</strong></h3>
<div style="margin-bottom: 2rem"></div>

<p><img src="/blog/images/system-test/flow-chart.png" width="425" /></p>
<div style="margin-bottom: 2rem"></div>

<ul>
  <li><strong>Minitest</strong>
    <ul style="margin-left: 2rem">
<li><a href="https://github.com/seattlerb/minitest" target="_blank" style="color: blue;">Minitest</a> is a small and incredibly fast unit testing framework.</li>
<li>It provides the base classes for test cases.
  For Rails System Tests, Rails provides an ApplicationSystemTestCase base class which is in turn based on  <i>ActionDispatch::SystemTestCase:</i></li>
</ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span>  <span class="nb">require</span> <span class="s2">&quot;test_helper&quot;</span>

  <span class="k">class</span> <span class="nc">ApplicationSystemTestCase</span> <span class="o">&lt;</span> <span class="no">ActionDispatch</span><span class="o">::</span><span class="no">SystemTestCase</span>
    <span class="n">driven_by</span> <span class="ss">:selenium</span><span class="p">,</span> <span class="ss">using</span><span class="p">:</span> <span class="ss">:chrome</span><span class="p">,</span> <span class="ss">screen_size</span><span class="p">:</span> <span class="o">[</span><span class="mi">1400</span><span class="p">,</span> <span class="mi">1400</span><span class="o">]</span>
  <span class="k">end</span>
  </code></pre></figure>

<ul style="margin-left: 2rem">
  <li>In <code>ActionDispatch::SystemTestCase</code> we require the <code>capybara/minitest</code> library.</li>
  <li>It provides basics assertions like <strong>assert_equal, assert_nil, assert_same, assert_raises, assert_includes</strong>.</li>
  <li>A runner to run the tests and report on their success and failure.</li>
  </ul>

<ul>
  <li>
    <p><strong>Capybara</strong></p>

    <ul style="margin-left: 2rem">

  <li><a href="https://github.com/teamcapybara/capybara" target="_blank" style="color: blue;">Capybara</a> starts your app in a separate process before running the tests. This ensures that the tests are run against the correct version of your app.</li>
  <li>Capybara provides a high-level API that makes it easy to write tests in a natural way. For example, you can write a test that says <code>"click the button"</code> instead of having to write code to find the button and click it.</li>
  <li>Here is an example of a test written with Capybara's DSL (Domain Specific Language):</li>
</ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span>  <span class="n">visit</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">)</span>
  <span class="n">fill_in</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="ss">with</span><span class="p">:</span> <span class="s1">&#39;user@example.com&#39;</span><span class="p">)</span>
  <span class="n">fill_in</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="ss">with</span><span class="p">:</span> <span class="s1">&#39;password&#39;</span><span class="p">)</span>
  <span class="n">click_button</span><span class="p">(</span><span class="s1">&#39;Login&#39;</span><span class="p">)</span>
  </code></pre></figure>

<ul>
  <li>
    <p><strong>Selenium-Webdriver</strong></p>

    <ul style="margin-left: 2rem">
<li>Capybara uses the <a href="https://rubygems.org/gems/selenium-webdriver/versions/4.11.0" target="_blank" style="color: blue;">Selenium Webdriver</a> library to interact with real browsers. Selenium WebDriver is a cross-platform library that provides a way to control web browsers from code. Capybara uses Selenium WebDriver to translate its high-level DSL (Domain Specific Language) into low-level commands that the browser can understand.</li>
</ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span>  <span class="nb">require</span> <span class="s2">&quot;selenium-webdriver&quot;</span>

  <span class="n">driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
  <span class="n">driver</span><span class="o">.</span><span class="n">navigate</span><span class="o">.</span><span class="n">to</span> <span class="s2">&quot;http://google.com&quot;</span>

  <span class="n">element</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;q&#39;</span><span class="p">)</span>
  <span class="n">element</span><span class="o">.</span><span class="n">send_keys</span> <span class="s2">&quot;Hello WebDriver!&quot;</span>
  <span class="n">element</span><span class="o">.</span><span class="n">submit</span>

  <span class="nb">puts</span> <span class="n">driver</span><span class="o">.</span><span class="n">title</span>

  <span class="no">Driver</span><span class="o">.</span><span class="n">quit</span>
  </code></pre></figure>

<ul style="margin-left: 2rem">
  <li>You can see how it’s a bit lower-level than the Capybara example further up. The selenium-webdriver library translates these calls into WebDriver Protocol, which it speaks to a webdriver executable.</li>
  </ul>

<ul>
  <li>
    <p><strong>Webdriver Protocol</strong></p>

    <ul style="margin-left: 2rem">

<li>The Selenium WebDriver library translates its calls into the <a href="https://www.w3.org/TR/webdriver2/" target="_blank" style="color: blue;">WebDriver Protocol</a>. The WebDriver Protocol is a HTTP-based wire protocol that is used to communicate between the Selenium WebDriver library and the web browser.</li>
<li>In order to start a chrome browser window and navigate to google.com. We need to startup geckodriver.</li>
<li>We send it a <strong>“new session”</strong> command with a HTTP post request</li>
</ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span></span>  curl -X POST <span class="s1">&#39;http://127.0.0.1:9515/session&#39;</span> -d <span class="s1">&#39;{&quot;capabilities&quot;:{&quot;firstMatch&quot;:[{&quot;browserName&quot;:&quot;firefox&quot;}]}}&#39;</span>
  </code></pre></figure>

<ul style="margin-left: 2rem">

  <li>This return a session id along with data</li>
  </ul>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span></span>  <span class="o">{</span> ... <span class="s2">&quot;sessionId&quot;</span>:<span class="s2">&quot;f1776ba558e28309299dc5f62864e977&quot;</span> ... <span class="o">}</span>
  </code></pre></figure>

<ul style="margin-left: 2rem">

  <li>Then we make another post request with a session id. And url in data parameters</li>
  </ul>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span></span>  curl -X POST <span class="s1">&#39;http://127.0.0.1:9515/session/f1776ba558e28309299dc5f62864e977/url&#39;</span> -d <span class="s1">&#39;{&quot;url&quot;: &quot;https://google.com&quot;}&#39;</span>
  </code></pre></figure>

<ul>
  <li><strong>Webdriver</strong>
    <ul style="margin-left: 2rem">

<li>Webdriver is a tool that speaks <strong>“Webdriver protocol”</strong> and controls the browser.</li>
<li>Every major browser there is an associated webdriver tool. Chrome has <a href="https://sites.google.com/a/chromium.org/chromedriver/home" target="_blank" style="color: blue;">chromedriver</a>. Firefox has a <a href="https://github.com/mozilla/geckodriver" target="_blank" style="color: blue;">geckodriver</a>. MS Edge has <a href="https://developer.microsoft.com/en-us/microsoft-edge/tools/webdriver/" target="_blank" style="color: blue;">edgedriver</a>. Safari has <a href="https://developer.apple.com/documentation/webkit/testing_with_webdriver_in_safari" target="_blank" style="color: blue;">safaridriver</a>.</li>
<li>WebDriver tools act as servers: when you execute them, they start a persistent process that listens for HTTP requests until it is terminated.</li>
</ul>
  </li>
</ul>
<div style="margin-bottom: 1rem"></div>

<ul>
  <li><strong>Webdrivers gem</strong>
    <ul style="margin-left: 2rem">

<li>Before selenium-webdriver 4.11, <a href="https://github.com/titusfortner/webdrivers" target="_blank" style="color: blue;">webdrivers</a> gem automatically determines which WebDriver executable needs to be downloaded for your platform and selected browser, downloads it, and arranges for that executable to be used by selenium-webdriver.</li>
<li>From version 4.11, they have incorporated the functionality in selenium-webdriver gem using <a href="https://www.selenium.dev/blog/2023/whats-new-in-selenium-manager-with-selenium-4.11.0/" target="_blank" style="color: blue;">selenium-manager</a>.</li>

</ul>
  </li>
</ul>
<p><img src="/blog/images/system-test/webdriver.png" width="425" /></p>

<div style="margin-top: 2rem"></div>

<h3 id="running-rails-7-system-tests-with-docker-and-gitlab-runner-on-arm64-and-amd64-linux-machines"><strong>Running Rails 7 System Tests with Docker and Gitlab Runner on Arm64 and Amd64 linux machines</strong></h3>
<div style="margin-top: 2rem"></div>

<p><strong>Step 1: Prepare the Rails 7 application for testing</strong></p>

<ul>
  <li>Run the command below to generate a very basic Ruby on Rails 7 app:</li>
</ul>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span></span>rails new minitest-rails-app</code></pre></figure>

<ul>
  <li>Go ahead and open up the project in your favourite editor and proceed to the Gemfile, specifically to the test block:</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span>  <span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
    <span class="c1"># Use system testing [https://guides.rubyonrails.org/testing.html#system-testing]</span>
    <span class="n">gem</span> <span class="s2">&quot;capybara&quot;</span>
    <span class="n">gem</span> <span class="s2">&quot;selenium-webdriver&quot;</span>
    <span class="n">gem</span> <span class="s2">&quot;webdrivers&quot;</span>
  <span class="k">end</span>
  </code></pre></figure>

<ul>
  <li>Next, let’s do a quick scaffold generation to have something to work with:</li>
</ul>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span></span>  rails generate scaffold Blog title:string body:text
  </code></pre></figure>

<ul>
  <li>Usually, generating a scaffold will automatically generate the <code>application_system_test_case.rb</code> and everything you need for the system tests</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span>  <span class="n">application_system_test_case</span><span class="o">.</span><span class="n">rb</span> <span class="p">(</span><span class="n">default</span><span class="p">)</span> 
  
  <span class="nb">require</span> <span class="s2">&quot;test_helper&quot;</span>
  
  <span class="k">class</span> <span class="nc">ApplicationSystemTestCase</span> <span class="o">&lt;</span> <span class="no">ActionDispatch</span><span class="o">::</span><span class="no">SystemTestCase</span>
    <span class="n">driven_by</span> <span class="ss">:selenium</span><span class="p">,</span> <span class="ss">using</span><span class="p">:</span> <span class="ss">:chrome</span><span class="p">,</span> <span class="ss">screen_size</span><span class="p">:</span> <span class="o">[</span><span class="mi">1400</span><span class="p">,</span> <span class="mi">1400</span><span class="o">]</span>
  <span class="k">end</span>
  </code></pre></figure>

<ul>
  <li>Run the database commands</li>
</ul>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span></span>  rails db:setup
  rails db:migrate
  </code></pre></figure>

<ul>
  <li>Running a Basic System For the First Time</li>
</ul>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span></span>  rails test:system
  </code></pre></figure>

<p><strong>Step 2: Exclude the gem webdrivers from the list of dependencies</strong></p>
<ul>
  <li>Before selenium-webdriver 4.11, webdrivers gem automatically download webdriver executable.</li>
  <li>From version 4.11, they have incorporated the functionality in selenium-webdriver gem using selenium-manager.</li>
  <li>We can comment out the webdrivers line from Gemfile.</li>
  <li>After change, <code>Gemfile</code> looks like this</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span>  <span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="c1"># Use system testing [https://guides.rubyonrails.org/testing.html#system-testing]</span>
  <span class="n">gem</span> <span class="s2">&quot;capybara&quot;</span>
  <span class="n">gem</span> <span class="s2">&quot;selenium-webdriver&quot;</span><span class="p">,</span> <span class="s2">&quot;~&gt; 4.11&quot;</span>
  <span class="c1">#gem &quot;webdrivers&quot;</span>
  <span class="k">end</span>
  </code></pre></figure>

<p><strong>Step 3: Point the Selenium-webdriver to use the firefox browser</strong></p>
<ul>
  <li>As chrome has not released binary compatible with <code>linux/arm64</code> machine. So the test failed on the arm64 linux machine. I tried multiple approaches to make it work with headless_chrome, but didn’t work and commend the issue in details in this  <a href="https://github.com/titusfortner/webdrivers/issues/213#issuecomment-1686094017" target="_blank" style="color: blue;">issue tracker</a></li>
  <li>We need to change the browser to the firefox.</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span>  <span class="c1">#application_system_test_case.rb (change driver to Firefox)</span>
 
  <span class="nb">require</span> <span class="s2">&quot;test_helper&quot;</span>
  
  <span class="k">class</span> <span class="nc">ApplicationSystemTestCase</span> <span class="o">&lt;</span> <span class="no">ActionDispatch</span><span class="o">::</span><span class="no">SystemTestCase</span>
    <span class="n">driven_by</span> <span class="ss">:selenium</span><span class="p">,</span> <span class="ss">using</span><span class="p">:</span> <span class="ss">:firefox</span><span class="p">,</span> <span class="ss">screen_size</span><span class="p">:</span> <span class="o">[</span><span class="mi">1400</span><span class="p">,</span> <span class="mi">1400</span><span class="o">]</span>
  <span class="k">end</span>
  </code></pre></figure>

<p><strong>Step 4: Prepare the docker image</strong></p>

<ul>
  <li>Create <code>Dockerfile</code></li>
</ul>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span></span>  FROM ruby:3.1.2-slim-buster

  RUN apt-get update
  RUN apt-get -y install gnupg curl wget xvfb unzip

  ENV NODE_VERSION <span class="m">19</span>

  RUN curl -fsSL https://deb.nodesource.com/setup_<span class="si">${</span><span class="nv">NODE_VERSION</span><span class="si">}</span>.x <span class="p">|</span> bash -  <span class="o">&amp;&amp;</span> <span class="se">\</span>
  apt-get install --yes nodejs <span class="o">&amp;&amp;</span> <span class="se">\</span>
  apt-get install --yes libxss1 libappindicator1 libindicator7 python2

  RUN apt-get update <span class="o">&amp;&amp;</span> <span class="se">\</span>
  apt-get install --yes software-properties-common build-essential libssl-dev sqlite3 libsqlite3-dev pkg-config ca-certificates firefox-esr

  RUN apt-get install -y git-all
  RUN npm install yarn -g
  ADD . /data
  </code></pre></figure>

<ul>
  <li>
    <p>This Dockerfile sets up an image with Ruby 3.1.2 and Node.js 19 installed. It installs system dependencies like Git, Yarn, various libraries for sqlite and Firefox.</p>
  </li>
  <li>
    <p>Build Docker image</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span></span>  docker buildx build -t dockermanishelitmus/systemtest-rails-app:latest1.0 . --platform linux/amd64,linux/arm64 --push
  </code></pre></figure>

<ul>
  <li>Command is building a Docker image using the buildx extension, targeting two different platforms (Intel/AMD 64-bit and ARM 64-bit), tagging the image as latest1.0, and pushing the resulting image to a container registry.</li>
</ul>

<p><strong>Step 5: Prepare the gitlab-runner</strong></p>

<ul>
  <li>In the project root directory create a file <code>.gitlab-ci.yml</code> with content</li>
</ul>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span></span><span class="nt">image</span><span class="p">:</span> <span class="s">&quot;dockermanishelitmus/systemtest-rails-app:latest1.0&quot;</span>
<span class="nt">services</span><span class="p">:</span>
 <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">redis:latest</span>
<span class="nt">variables</span><span class="p">:</span>
 <span class="nt">RAILS_ENV</span><span class="p">:</span> <span class="s">&quot;test&quot;</span>

<span class="nt">cache</span><span class="p">:</span>
 <span class="nt">paths</span><span class="p">:</span>
   <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">vendor/ruby</span>
   <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">node_modules/</span>

<span class="nt">before_script</span><span class="p">:</span>
 <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">gem install bundler  --no-document</span>
 <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bundle config set force_ruby_platform true</span>
 <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bundle install</span>
 <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bin/rake db:drop</span>
 <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bin/rake db:setup</span>
 <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bin/rake db:migrate</span>

<span class="nt">stages</span><span class="p">:</span>
 <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">tests</span>

<span class="nt">SystemTests</span><span class="p">:</span>
 <span class="nt">stage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tests</span>
 <span class="nt">script</span><span class="p">:</span>
   <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">yarn install</span>
   <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bin/rake assets:precompile</span>
   <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bin/rails test:system</span>
 <span class="nt">artifacts</span><span class="p">:</span>
   <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">on_failure</span>
   <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;$CI_JOB_NAME-$CI_COMMIT_REF_NAME&quot;</span>
   <span class="nt">paths</span><span class="p">:</span>
     <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">coverage/</span>
   <span class="nt">expire_in</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1 day</span></code></pre></figure>

<ul>
  <li>Finally run your test suite</li>
</ul>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span></span>gitlab-runner <span class="nb">exec</span> docker SystemTests</code></pre></figure>

<ul>
  <li>Output</li>
</ul>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span></span>  $ bin/rails test:system
  Running <span class="m">4</span> tests <span class="k">in</span> a single process <span class="o">(</span>parallelization threshold is <span class="m">50</span><span class="o">)</span>
  Run options: --seed <span class="m">13031</span>

  <span class="c1"># Running:</span>

  Capybara starting Puma...
  * Version <span class="m">5</span>.6.7 , codename: Birdie<span class="err">&#39;</span>s Version
  * Min threads: <span class="m">0</span>, max threads: <span class="m">4</span>
  * Listening on http://127.0.0.1:33385
  ....

  Finished <span class="k">in</span> <span class="m">7</span>.865541s, <span class="m">0</span>.5085 runs/s, <span class="m">0</span>.5085 assertions/s.
  <span class="m">4</span> runs, <span class="m">4</span> assertions, <span class="m">0</span> failures, <span class="m">0</span> errors, <span class="m">0</span> skips
  Saving cache <span class="k">for</span> successful job
  Creating cache SystemTests/main...
  WARNING: vendor/ruby: no matching files. Ensure that the artifact path is relative to the working directory
  node_modules/: found <span class="m">2</span> matching files and directories
  No URL provided, cache will not be uploaded to shared cache server. Cache will be stored only locally.
  Created cache
  Job succeeded</code></pre></figure>

<h3 id="conclusion"><strong>Conclusion</strong></h3>

<p>Now we have a setup that enables us to run system tests in both arm64 and amd64 linux machines with minimal customizations we may want to add. A few tips and tricks should help to get your first system tests up and running in CI pipeline.</p>

              </div>
              <div class="entry-tags">
                <div class=' social-sharing pull-right'>        
     
</div>
              </div>
              <div class="clearfix"><br/></div>

                <div class="panel panel-default">

  

  

  

  

  

  

  

  

  

  

  

  
    
      <div class="panel-body">
        <div class="container-fluid">

          <div class="row">
            <div class="col-sm-12 col-md-4">
              <center>
                <img src="/blog/images/manish.jpg" alt="Manish Sharma photo" class="author-photo img-circle img-responsive"/>
                
                <span class="author vcard">
                  <span class="fn">Manish Sharma</span>
                </span>

                <div class="nav-icon-size-reduce social-icons">
                  
                    <a href="https://twitter.com/ManishS77291587"  title="Manish Sharma on Twitter"  target="_blank"><i class="fa fa-twitter "></i></a>
                  
                  
                  
                  

                  
                    <a href="https://linkedin.com/in/heymanish" title="Manish Sharma on LinkedIn" target="_blank"><i class="fa fa-linkedin "></i></a>
                  

                  

                  

                  

                  
                    <a href="https://github.com/maniSHarma7575" title="Manish Sharma on Github" target="_blank"><i class="fa fa-github "></i></a>
                  

                     
                </div><!-- /.social-icons -->
              </center>
            </div>

            <div class="col-sm-12 col-md-8">
              
                <span class="author-bio">Manish Sharma is a member of Technology at eLitmus. He is passionate about building stuffs. Loves to spend time with nature and do swimming.</span>
              
            </div>

          </div>

        </div>
      </div>

  

  

  

  

  

</div>
                <div id='discourse-comments'></div>

<script type="text/javascript">
  DiscourseEmbed = { discourseUrl: 'https://adda.elitmus.com/',
                     discourseEmbedUrl: 'https://www.elitmus.com/blog/technology/demystifying-rails-7-system-tests-configuring-ci-pipeline/'
                   };

  (function() {
    var d = document.createElement('script'); 
    d.type = 'text/javascript'; 
    d.async = true;
    d.src = DiscourseEmbed.discourseUrl + 'javascripts/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d);
  })();
</script>


                
              </div><!-- /.entry-content -->
            </div><!-- /.entry-wrapper -->

          </article>

          <nav class="navbar nav-justified" role="navigation">
            <ul class="nav pager">
              
                <li class="previous showElem mr-auto"><a href="/blog/technology/building-a-frontend-scoring-engine-automating-frontend-evaluation/" title="Building a Frontend Scoring Engine: Automating Frontend Evaluation">&larr;<span class="showPrevNex"> Previous </span> </a></li>
              
              
                <li class="next showElem ml-auto"><a href="/blog/technology/puma-from-daemonization-to-process-control-with-systemctl-and-monit/" title="Puma: From Daemonization to Process Control with Systemctl and Monit"> <span class='showPrevNex'> Next </span> &rarr; </a></li>
              
            </ul>
          </nav>
        
        </div><!-- /#main -->

      <!--/col-md-2 -->
      <div class="col-md-2">

      </div>

    </div><!-- /row -->
    </div>
    <div class="footer-color">
      <footer role="contentinfo">
        <center>
            <span class='footer-text'>
    &copy;  2005-<script> document.write(new Date().getFullYear()) </script>, eLitmus.com. | <a href="/terms_of_use/">Terms of Use</a> &middot; <a href="/privacy_policy/">Privacy Policy</a>

  </span>
        </center>
      </footer>
    </div><!-- /.footer-wrapper -->
    

	<script async src="https://www.googletagmanager.com/gtag/js?id=G-CB7H9KN61P"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'G-CB7H9KN61P');
	</script>



<!-- Load Modernizr -->
<script src="/blog/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- adding jquery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- end of jquery -->

<script src="/blog/assets/js/scripts.min.js"></script>
<script src="/blog/assets/js/lunr.min.js"></script>
<script src="/blog/assets/js/lunr-search.js"></script>
<script src="/blog/assets/js/plugins/headroom.min.js"></script>
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
<script src="/blog/assets/js/vendor/forkit.js"></script>
  

  </body>
</html>
