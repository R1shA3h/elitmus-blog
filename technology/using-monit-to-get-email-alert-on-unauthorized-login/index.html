<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Using Monit to get email alert on unauthorized login &#8211; eLitmus Blog</title>
<meta name="description" content="We learn new things everyday, and we document our learnings here...">

<meta name="keywords" content="ssh, monit, alert">

<!-- Twitter Cards -->
  <meta name="twitter:card" content="summary">    
<meta name="twitter:title" content="Using Monit to get email alert on unauthorized login">
<meta name="twitter:description" content=" Apart from process monitoring, monit can also send alert messages on certain events. This feature can be used to get notified whenever someone logs into your unix/linux server">
<meta name="twitter:site" content="@elitmus">
<meta name="twitter:image" content="/blog/images/default_og.png">

    
        
            <meta name="twitter:creator" content="@shireeshj">
        
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    




<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:image" content="/blog/images/default_og.png"/>
<meta property="og:image:width" content="1280"/>
<meta property="og:image:height" content="720"/>
<meta property="og:type" content="article">
<meta property="og:title" content="Using Monit to get email alert on unauthorized login">
<meta property="og:description" content="Apart from process monitoring, monit can also send alert messages on certain events. This feature can be used to get notified whenever someone logs into your unix/linux server">
<meta property="og:url" content="/blog/technology/using-monit-to-get-email-alert-on-unauthorized-login/">
<meta property="og:site_name" content="eLitmus Blog">








<link rel="canonical" href="https://www.elitmus.com/blog/technology/using-monit-to-get-email-alert-on-unauthorized-login/">
<link href="/blog/feed.xml" type="application/atom+xml" rel="alternate" title="eLitmus Blog Feed">


	<link rel="author" href="https://plus.google.com/+eLitmus?rel=author">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Icons -->
<!-- apple touch icons -->
<link rel="apple-touch-icon" sizes="57x57" href="/blog/images/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="114x114" href="/blog/images/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/blog/images/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="144x144" href="/blog/images/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="60x60" href="/blog/images/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="120x120" href="/blog/images/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="76x76" href="/blog/images/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="152x152" href="/blog/images/apple-touch-icon-152x152.png">
<!-- Favicons default 16x16 -->
<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="/blog/favicon.ico">

<!-- Favicons others -->
<link rel="icon" type="image/png" href="/blog/images/favicon-196x196.png" sizes="196x196">
<link rel="icon" type="image/png" href="/blog/images/favicon-160x160.png" sizes="160x160">
<link rel="icon" type="image/png" href="/blog/images/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/blog/images/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/blog/images/favicon-32x32.png" sizes="32x32">

<!-- Icons for Windows 8 Tiles -->
<meta name="msapplication-TileColor" content="#ffffff"/>
<meta name="msapplication-TileImage" content="/blog/images/mstile-144x144.png">

<!-- For all browsers -->


<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:600,300,300italic|The+Girl+Next+Door" rel="stylesheet" type="text/css">
<link href='//fonts.googleapis.com/css?family=Source+Code+Pro:300' rel='stylesheet' type='text/css'>

<meta http-equiv="cleartype" content="on">

<!-- bootstrap 4 -->
<link rel="stylesheet" type="text/css" href="/blog/assets/css/bootstrap.min.css">

<!-- below css file is used for navbar in individual blogposts -->
<link rel="stylesheet" type="text/css" href="/blog/assets/css/main.min.css">

<!-- <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css"> -->

<!-- Optional theme -->
<link rel="stylesheet" type="text/css" href="/blog/assets/css/bootstrap-theme.min.css">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Font Awesome -->
<link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="/blog/assets/css/font-elitmuslogo.css" />

<link rel="stylesheet" href="/blog/assets/css/customize.css">
<link rel="stylesheet" href="/blog/assets/css/forkit.css">

<!-- Prism -->
<link rel="stylesheet" href="/blog/assets/css/prism.css">

</head>

<body id="post">

  <header class="headroom">

  <nav class="navbar navbar-expand-md navbar-dark bg-black fixed-top" role="navigation">

      <a class="navbar-brand" href="/blog/">
        <img src="/blog/images/elitmus-only-logo.svg" class="img-logo">
        <span><div class="blog-label">blog</div></span>
      </a>

      <!-- the toggle button -->
      <button type="button" class="navbar-toggler" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="navbar-toggler-icon"></span>
        <span class="sr-only">Toggle navigation</span><!-- only for screen readers -->
      </button>

      <div class="collapse navbar-collapse">
        <ul class="nav navbar-nav mr-auto">

          <!-- first item = dropdown search -->
          <li class="nav-item">
            <div class="dropdown search-box-margin">

            
              <div class="form-inline">
                 

                <input data-toggle="dropdown" placeholder="Search..." id="search-box" class="form-control form-control-sm search-input dropdown-toggle" aria-haspopup="true" aria-expanded="false">


                <div class="dropdown-menu" id="search-dropdown">
                  <a role='presentation' class='dropdown-item search-results'> Type more.... </a>
                </div>

              </div>



            <!-- the below line will pass "search word" to search.html -->

            <!--
            <form class="form-inline" action="/blog/search" method="get">
               


              <label for="search_box">Search</label>
              <input data-toggle="dropdown" type="text" name="query" placeholder="Search..." id="search-box" class="form-control form-control-sm search-input dropdown-toggle" aria-haspopup="true" aria-expanded="false">

              <div class="dropdown-menu" id="search-dropdown">
                  <a role='presentation' class='dropdown-item search-results'> Type more.... </a>
              </div>

              <input type="submit" value="search">

            </form>
            -->

            <!-- end of form -->


            </div>
          </li>
        </ul>

        

        <!-- every link on the right side -->
        <ul class="nav navbar-nav navbar-right nav-icon-size-reduce">
          
          <li class="nav-item">
             
              <a href="/blog/" class="nav-link">
                <i class="fa fa-home"></i> Home
              </a>
            
          </li>
          
          <li class="nav-item">
             
              <a href="/blog/posts/" class="nav-link">
                <i class="fa fa-file-text-o"></i> Posts
              </a>
            
          </li>
          
          <li class="nav-item">
             
              <a href="//www.elitmus.com/" class="nav-link">
                <i class="el el-elitmuslogo"></i> eLitmus
              </a>
            
          </li>
          

          <!-- feed is the last link -->
          <li class="nav-item">
            <a href="/blog/feed.xml" class="nav-link" title="Atom/RSS feed">
              <i class="fa fa-rss"></i> Feed
            </a>
          </li>
        </ul>



      </div> <!-- /.navbar-collapse -->

  </nav><!--[if lt IE 9]><div class="upgrade"><strong><a href="https://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
</header>
<!-- 

  <div class="search-wrapper">
    <div class="search-form">
      <input type="text" class="search-field" placeholder="Search...">
      <i class="icon-remove-sign icon-2x"></i>
      <ul class="search-results post-list"></ul> -->
<!-- /.search-results -->
<!-- </div> -->
<!-- /.search-form -->
<!-- </div> -->
<!-- ./search-wrapper -->
<!--  -->

  

  <div class="container-fluid">

  <div class="row">


    <div class="col-md-2"></div>
      <div class="col-md-8">
        <div id="main" role="main" class="marginal ">
          <article class="entry">

          

            <div>
              <header>
                <span class="entry-tags">
                  
                    <a href="/blog/tags/#ssh" title="Pages tagged ssh">ssh</a>
                    &nbsp;&bull;&nbsp;
                  
                    <a href="/blog/tags/#monit" title="Pages tagged monit">monit</a>
                    &nbsp;&bull;&nbsp;
                  
                    <a href="/blog/tags/#alert" title="Pages tagged alert">alert</a>
                    
                  

                  <div class=' social-sharing pull-right'>        
  
    <span class="social-share-facebook">
      <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.elitmus.com/blog/technology/using-monit-to-get-email-alert-on-unauthorized-login/" title="Share on Facebook" itemprop="Facebook"><i class="fa fa-facebook-square fa-lg"></i> Like</a>
    </span>&nbsp;&nbsp;
    <span class="social-share-twitter">
       <a href="https://twitter.com/share?hashtags=technology&text=Using Monit to get email alert on unauthorized login&via=elitmus" title="Share on Twitter" itemprop="Twitter"><i class="fa fa-twitter-square  fa-lg"></i></i> Tweet</a>
    </span>&nbsp;&nbsp;
     
</div>

                </span>
              
                
                  <h1 class="no-padding">Using Monit to get email alert on unauthorized login</h1>
                
              </header>
            </div>
           
            <div>
              <div>
                <span class='badge badge-warning'> <a href="/blog/categories/technology/index.html" > technology </a></span>
              </div>

              
                <div class='pull-left date-show'>
                  <span class="entry-date date published">
                    <time datetime="2014-06-04T00:00:00+05:30">
                      <i class="fa fa-calendar"></i> June 04, 2014
                    </time>
                  </span>&nbsp;

                  

                </div>

                <div class='pull-right date-show'>
                  <span>
                    <a href="/blog/technology/using-monit-to-get-email-alert-on-unauthorized-login/" rel="bookmark" title="Using Monit to get email alert on unauthorized login">
                      <i class="fa fa-link"></i> Permalink
                    </a>
                  </span>
                </div>

              <br>
              <div class="panel panel-default">
                <div class="panel-heading ">
                  <h3 class="panel-title">TL;DR</h3>
                </div>
                <div class="panel-body">
                  <aside>Apart from process monitoring, monit can also send alert messages on certain events. This feature can be used to get notified whenever someone logs into your unix/linux server</aside>
                </div>
              </div>
      
            

              <div class="post-content-justify">
                <p>For a long time, we had our own custom written perl script to alert us whenever someone logged into our production servers from an ip address we do not recognize (not whitelisted). The script looked somewhat like this…</p>

<figure class="highlight"><pre><code class="language-perl" data-lang="perl">#!/usr/bin/perl
# script file: alert_on_login.pl
#
my $login_str = &quot;Accepted publickey&quot;;
my $whitelist_ip = &quot;122.123.123.111&quot;;

sub sendEmail
{
        my ($to, $from, $subject, $message) = @_;
        my $sendmail = &#39;/usr/lib/sendmail&#39;;
        open(MAIL, &quot;|$sendmail -oi -t&quot;);
        print MAIL &quot;From: $from\n&quot;;
        print MAIL &quot;To: $to\n&quot;;
        print MAIL &quot;Subject: $subject\n\n&quot;;
        print MAIL &quot;$message\n&quot;;
        close(MAIL);
}

while (&lt;&gt;) {
        if (grep(/$login_str/, $_) &amp;&amp; !grep(/$whitelist_ip/, $_)) {
                print $_;
                chomp $_;
                @arr = split(&#39; &#39;, $_);
                sendEmail(&#39;recepient1@elitmus.com, recepient2@elitmus.com&#39;,
                          &#39;monit@elitmus.com&#39;,
                          &#39;Server login from &#39; . $arr[10],
                          $_);
        }
}</code></pre></figure>

<p>All we needed to do was to run this script in the background as a daemon, and it would send us an email alert whenever someone logged in successfully. As root user start the script like this:</p>

<pre><code>  # (perl alert_on_login.pl /var/log/auth.log &amp;)
</code></pre>

<p>Ever since we started using <a href="https://mmonit.com/monit/">monit</a> for the usual purpose (monitoring processes), we have also entrusted <a href="https://mmonit.com/monit/">monit</a> to do the job of the above perl script. <a href="https://mmonit.com/monit/">Monit</a> makes this super simple…</p>

<p><a href="https://mmonit.com/monit/">Monit</a> is a popular opensource process monitoring tool. It is used mostly for monitoring health of any linux process and take necessary action if any of the set parameters are breached. Monit can restart a process if the process failed for some reason. Monit can also notify you of incidents and actions taken.</p>

<p><a href="https://mmonit.com/monit/documentation/monit.html#alert_messages">See this</a> to learn more about <a href="https://mmonit.com/monit/">monit’s</a> alert capabilities.</p>

<p><a href="https://mmonit.com/monit/">Monit’s</a> global configuration file is usually /etc/monit/monitrc. Here is what <a href="https://mmonit.com/monit/">monit</a> needs to be told about how to send email alerts:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">...
# This is our SMTP server settings. The complete syntax is
# SET MAILSERVER &lt;hostname [PORT] [USERNAME] [PASSWORD] [using SSLAUTO|SSLV2|SSLV3|TLSV11|TLSV12] [CERTMD5 checksum]&gt;, ...
#          [with TIMEOUT X SECONDS]
#          [using HOSTNAME hostname]
#
# But for our purpose, localhost is good enough
SET mailserver localhost

# This is the email template for alert messages
SET mail-format {
  from: monit@elitmus.com
  subject: $SERVICE $EVENT at $DATE
  message: Monit $ACTION $SERVICE at $DATE on $HOST: $DESCRIPTION.
           Yours sincerely,
           monit
}

# Alerts can be triggered for various reasons. Successful ssh login is just one of those reasons.
# Since this is a global configuration, we can tell monit to not send alerts for certain events
#  We also specify the email address of the recepient who will receive the alerts

set alert recepient1@elitmus.com NOT ON { action, instance, pid, ppid, nonexist }
...</code></pre></figure>

<p>And then we add this config file <code>ssh_logins.conf</code> specific to sshd related stuff:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">check file ssh_logins with path /var/log/auth.log
  ignore match &quot;/etc/monit/whitelist_ips.regex&quot;
  if match &quot;Accepted publickey&quot; then alert</code></pre></figure>

<p>Notice how we tell <a href="https://mmonit.com/monit/">monit</a> to ignore logins from known ip addresses. We can now store all whitelist ip addresses in a separate file <code>/etc/monit/whitelist_ips.regex</code>, one address per line.</p>

<p><strong>Note:</strong> We have disabled password based login and hence do not monitor for passworded logins. If you use passworded login, you should change <code>"Accepted publickey"</code> to <code>"Accepted password"</code></p>

<p>Happy monitoring!</p>


              </div>
              <div class="entry-tags">
                <div class=' social-sharing pull-right'>        
  
    <span class="social-share-facebook">
      <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.elitmus.com/blog/technology/using-monit-to-get-email-alert-on-unauthorized-login/" title="Share on Facebook" itemprop="Facebook"><i class="fa fa-facebook-square fa-lg"></i> Like</a>
    </span>&nbsp;&nbsp;
    <span class="social-share-twitter">
       <a href="https://twitter.com/share?hashtags=technology&text=Using Monit to get email alert on unauthorized login&via=elitmus" title="Share on Twitter" itemprop="Twitter"><i class="fa fa-twitter-square  fa-lg"></i></i> Tweet</a>
    </span>&nbsp;&nbsp;
     
</div>
              </div>
              <div class="clearfix"><br/></div>

                <div class="panel panel-default">

  
    
      <div class="panel-body">
        <div class="container-fluid">

          <div class="row">
            <div class="col-sm-12 col-md-4">
              <center>
                <img src="/blog/images/shireeshj.png" alt="Shireesh Jayashetty photo" class="author-photo img-circle img-responsive"/>
                
                <span class="author vcard">
                  <span class="fn">Shireesh Jayashetty</span>
                </span>

                <div class="nav-icon-size-reduce social-icons">
                  
                    <a href="https://twitter.com/shireeshj"  title="Shireesh Jayashetty on Twitter"  target="_blank"><i class="fa fa-twitter "></i></a>
                  
                  
                  
                  

                  
                    <a href="https://linkedin.com/in/shireeshj" title="Shireesh Jayashetty on LinkedIn" target="_blank"><i class="fa fa-linkedin "></i></a>
                  

                  

                  

                  

                  
                    <a href="https://github.com/shireeshj" title="Shireesh Jayashetty on Github" target="_blank"><i class="fa fa-github "></i></a>
                  

                     
                </div><!-- /.social-icons -->
              </center>
            </div>

            <div class="col-sm-12 col-md-8">
              
                <span class="author-bio">Shireesh heads technology at eLitmus. He is generally curious about things, especially technology. His curiosity almost cost him his first job when he hacked into a customer's system to gain unauthorized internet access (mid '90s). He was lucky, his employer saw this as a potential rather than a threat.</span>
              
            </div>

          </div>

        </div>
      </div>

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

</div>
                <div id='discourse-comments'></div>

<script type="text/javascript">
  DiscourseEmbed = { discourseUrl: 'https://adda.elitmus.com/',
                     discourseEmbedUrl: 'https://www.elitmus.com/blog/technology/using-monit-to-get-email-alert-on-unauthorized-login/'
                   };

  (function() {
    var d = document.createElement('script'); 
    d.type = 'text/javascript'; 
    d.async = true;
    d.src = DiscourseEmbed.discourseUrl + 'javascripts/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d);
  })();
</script>


                
              </div><!-- /.entry-content -->
            </div><!-- /.entry-wrapper -->

          </article>

          <nav class="navbar nav-justified" role="navigation">
            <ul class="nav pager">
              
                <li class="previous showElem mr-auto"><a href="/blog/technology/gotchas-while-syntactically-translating-aes-encryption-logic-from-php-to-ruby/" title="Gotcha's while syntactically translating AES encryption logic from PHP to Ruby">&larr;<span class="showPrevNex"> Previous </span> </a></li>
              
              
                <li class="next showElem ml-auto"><a href="/blog/technology/how-we-host-our-blog-on-github-pages-and-yet-serve-it-from-our-own-sub-url/" title="How we host our blog on GitHub pages and yet serve it from our own Sub-URL"> <span class='showPrevNex'> Next </span> &rarr; </a></li>
              
            </ul>
          </nav>
        
        </div><!-- /#main -->

      <!--/col-md-2 -->
      <div class="col-md-2">

      </div>

    </div><!-- /row -->
    </div>
    <div class="footer-color">
      <footer role="contentinfo">
        <center>
            <span class='footer-text'>
    &copy;  2005-<script> document.write(new Date().getFullYear()) </script>, eLitmus.com. | <a href="/terms_of_use/">Terms of Use</a> &middot; <a href="/privacy_policy/">Privacy Policy</a>

  </span>
        </center>
      </footer>
    </div><!-- /.footer-wrapper -->
    

	<script async src="https://www.googletagmanager.com/gtag/js?id=G-CB7H9KN61P"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'G-CB7H9KN61P');
	</script>



<!-- Load Modernizr -->
<script src="/blog/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- adding jquery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- end of jquery -->

<script src="/blog/assets/js/scripts.min.js"></script>
<script src="/blog/assets/js/lunr.min.js"></script>
<script src="/blog/assets/js/lunr-search.js"></script>
<script src="/blog/assets/js/plugins/headroom.min.js"></script>
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
<script src="/blog/assets/js/vendor/forkit.js"></script>

<!-- Prism -->
<script src="/blog/assets/js/prism.js"></script>
  

  </body>
</html>
